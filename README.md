была написана транзакция которая состоит из 2х этапов: создание копии измененяемой структуры, далее попытка изменения копии и изменение оригинала при успехе.

каждая операция оформляется как лямбда, принимает обьект и при выбросе исключений или неуспеха меняет флаг на false-> операция не успешна и ничего не меняется.

Принцип работы:
сначала делаем копию и сохраняем ссылку на оригинал, применяем переданные операции к копии и если ловим что угодно кроме успеха то флагаем ошибку и дальше не работаем. -> прога завершится с фолсом и не будет выкинуто ворнингов или ероров.

если все нормально сработало то срабатывает commit функция и применяет все изменение к оригиналу, ссылку на который мы сохранили